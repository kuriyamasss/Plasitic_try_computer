# 产品开发费用统计系统

一个简单但功能完整的Python程序，用于统计产品开发过程中的各项费用。

## 功能特点

1. **多种费用类型支持**
   - 人力成本（工时 × 时薪）
   - 材料费（数量 × 单价）
   - 设备费（使用时长 × 费率）
   - 其他自定义费用

2. **灵活的计算公式**
   - 预定义公式：常用计算公式
   - 自定义公式：支持任意Python表达式
   - 混合模式：预定义公式 + 自定义公式

3. **数据持久化**
   - SQLite数据库存储
   - 自动创建数据库和表结构
   - 支持数据查询和统计

4. **数据导出**
   - Excel格式导出（.xlsx）
   - CSV格式导出（.csv）
   - 包含统计摘要
   - 支持按类型和日期范围筛选

5. **统计分析**
   - 费用总额统计
   - 按类型分类统计
   - 平均费用计算
   - 时间范围统计

## 安装要求

- Python 3.6+
- 依赖包：
  - pandas>=1.5.0
  - openpyxl>=3.0.0

## 快速开始

### 1. 安装依赖
```bash
pip install -r requirements.txt
```

### 2. 运行程序
```bash
python main.py
```

### 3. 测试系统
```bash
python test_system.py
```

## 使用方法

### 主菜单选项
```
1. 添加费用记录
2. 查看所有费用记录
3. 按类型查看费用记录
4. 查看费用统计
5. 导出数据
6. 添加自定义公式
7. 删除费用记录
8. 列出导出文件
9. 退出系统
```

### 添加费用记录
1. 选择费用类型（人力、材料、设备、其他）
2. 输入费用名称
3. 选择计算公式或手动输入金额
4. 输入相关参数（如工时、时薪等）
5. 填写备注信息（可选）

### 自定义公式
1. 在主菜单中选择"6. 添加自定义公式"
2. 输入公式代号（英文，用于内部引用）
3. 输入公式显示名称
4. 输入计算公式表达式（如：`a * b + c`）
5. 输入参数列表（用逗号分隔，如：`a,b,c`）
6. 添加公式描述（可选）

### 导出数据
1. 在主菜单中选择"5. 导出数据"
2. 选择导出格式（Excel或CSV）
3. 选择导出范围（全部、按类型、按日期）
4. 输入自定义文件名（可选）
5. 系统将生成导出文件并显示保存位置

## 项目结构

```
cost_tracker/
├── main.py              # 主程序入口
├── database.py          # 数据库操作
├── expense_manager.py   # 费用管理逻辑
├── export_manager.py    # 导出功能
├── config.py           # 配置文件
├── test_system.py      # 系统测试
├── requirements.txt    # 依赖包列表
├── README.md          # 说明文档
├── data/
│   └── expenses.db    # SQLite数据库文件
└── exports/           # 导出文件目录
```

## 配置说明

### 费用类型配置（config.py）
```python
EXPENSE_TYPES = {
    "labor": "人力成本",
    "material": "材料费", 
    "equipment": "设备费",
    "other": "其他费用"
}
```

### 预定义公式配置（config.py）
```python
PREDEFINED_FORMULAS = {
    "labor_cost": {
        "name": "人力成本",
        "expression": "hours * hourly_rate",
        "params": ["hours", "hourly_rate"],
        "description": "人力成本 = 工时 × 时薪"
    },
    # ... 更多公式
}
```

## 示例使用场景

### 场景1：统计开发工时费用
- 费用类型：人力成本
- 公式：人力成本 = 工时 × 时薪
- 参数：工时=40小时，时薪=200元
- 结果：40 × 200 = 8000元

### 场景2：统计材料采购费用
- 费用类型：材料费
- 公式：材料费 = 数量 × 单价
- 参数：数量=100个，单价=5元
- 结果：100 × 5 = 500元

### 场景3：自定义公式
- 公式代号：custom_tax
- 显示名称：含税费用
- 表达式：`amount * 1.13`
- 参数：`amount`
- 描述：计算13%税率的含税费用

## 常见问题

### Q1: 程序无法启动，提示编码错误
A: 这是Windows终端编码问题，程序已内置解决方案。如果仍有问题，可以手动设置终端编码：
```bash
chcp 65001
python main.py
```

### Q2: 依赖包安装失败
A: 可以尝试使用国内镜像源：
```bash
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### Q3: 导出Excel文件打不开
A: 确保已安装openpyxl库，Excel文件需要使用Excel 2007或更高版本打开。

### Q4: 如何备份数据
A: 数据库文件位于`data/expenses.db`，可以直接复制备份。导出文件位于`exports/`目录。

## 更新日志

### v1.0 (2026-02-03)
- 初始版本发布
- 支持基本费用统计功能
- 支持自定义计算公式
- 支持Excel/CSV导出
- 完整的命令行界面

## 许可证

本项目使用MIT许可证。

## 贡献

欢迎提交问题和改进建议！